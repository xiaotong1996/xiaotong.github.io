<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="keyword" content="">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
        OpenGL（glut） 开发跳一跳实战 - undefined
        
    </title>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/aircloud.css">
    <link rel="stylesheet" href="/css/gitment.css">
    <!--<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">-->
    <link href="//at.alicdn.com/t/font_620856_pl6z7sid89qkt9.css" rel="stylesheet" type="text/css">
    <!-- ga & ba script hoook -->
    <script></script>
</head>

<body>

<div class="site-nav-toggle" id="site-nav-toggle">
    <button>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
    </button>
</div>

<div class="index-about">
    <i>  </i>
</div>

<div class="index-container">
    
    <div class="index-left">
        
<div class="nav" id="nav">
    <div class="avatar-name">
        <div class="avatar">
            <img src="/img/avatar.jpg">
        </div>
        <div class="name">
            <i>Xiaotong CHEN</i>
        </div>
    </div>
    <div class="contents" id="nav-content">
        <ul>
            <li>
                <a href="/">
                    <i class="iconfont icon-shouye1"></i>
                    <span>HOME</span>
                </a>
            </li>
            <li>
                <a href="/tags">
                    <i class="iconfont icon-biaoqian1"></i>
                    <span>TAGS</span>
                </a>
            </li>
            <li>
                <a href="/archives">
                    <i class="iconfont icon-guidang2"></i>
                    <span>ARCHIVES</span>
                </a>
            </li>
            <li>
                <a href="/about/">
                    <i class="iconfont icon-guanyu2"></i>
                    <span>ABOUT</span>
                </a>
            </li>
            
            <li>
                <a id="search">
                    <i class="iconfont icon-sousuo1"></i>
                    <span>SEARCH</span>
                </a>
            </li>
            
        </ul>
    </div>
    
        <div id="toc" class="toc-article">
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#OpenGL（glut）-开发跳一跳实战"><span class="toc-text">OpenGL（glut） 开发跳一跳实战</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-找到素材"><span class="toc-text">1. 找到素材</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-实现棋子的显示"><span class="toc-text">2. 实现棋子的显示</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-实现平台的显示"><span class="toc-text">3. 实现平台的显示</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实现棋子移动"><span class="toc-text">实现棋子移动</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实现棋子跳跃"><span class="toc-text">实现棋子跳跃</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实现类似劲舞团的输入响应"><span class="toc-text">实现类似劲舞团的输入响应</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#待解决问题"><span class="toc-text">待解决问题</span></a></li></ol></li></ol>
</div>
    
</div>


<div class="search-field" id="search-field">
    <div class="search-container">
        <div class="search-input">
            <span id="esc-search"> <i class="icon-fanhui iconfont"></i></span>
            <input id="search-input">
            <span id="begin-search">search</span>
        </div>
        <div class="search-result-container" id="search-result-container">

        </div>
    </div>
</div>
        <div class="index-about-mobile">
            <i>  </i>
        </div>
    </div>
    
    <div class="index-middle">
        <!-- Main Content -->
        


<div class="post-container">
    <div class="post-title">
        OpenGL（glut） 开发跳一跳实战
    </div>

    <div class="post-meta">
        <span class="attr">Post：<span>2019-11-06 22:45:12</span></span>
        
        <span class="attr">Tags：/
        
        <a class="tag" href="/tags/#OpenGL" title="OpenGL">OpenGL</a>
        <span>/</span>
        
        
        </span>
        <span class="attr">Visit：<span id="busuanzi_value_page_pv"></span>
</span>

    </div>
    <div class="post-content ">
        <h1 id="OpenGL（glut）-开发跳一跳实战"><a href="#OpenGL（glut）-开发跳一跳实战" class="headerlink" title="OpenGL（glut） 开发跳一跳实战"></a>OpenGL（glut） 开发跳一跳实战</h1><h2 id="1-找到素材"><a href="#1-找到素材" class="headerlink" title="1. 找到素材"></a>1. 找到素材</h2><p>因为老师给的glut库只支持特定格式的3D模型，本来想用blender建模导入，尝试不行。所以就先在网上先找到（.off) 的棋子模型</p>
<h2 id="2-实现棋子的显示"><a href="#2-实现棋子的显示" class="headerlink" title="2. 实现棋子的显示"></a>2. 实现棋子的显示</h2><ul>
<li>声明模型</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Model3D  *chess_piece_model = NULL; // main character model: chess piece</span><br></pre></td></tr></table></figure>
<ul>
<li>创建模型实例并加载资源</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chess_piece_model = new Model3D();</span><br><span class="line">chess_piece_model-&gt;load_3d_model(&quot;resources/chess_piece.off&quot;);</span><br></pre></td></tr></table></figure>
<ul>
<li><p>绘制模型</p>
<p>棋子颜色为黑色纯色，也可使用texture</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">void display_chess_piece_model()</span><br><span class="line">&#123;</span><br><span class="line">	</span><br><span class="line">	glPushMatrix();</span><br><span class="line"></span><br><span class="line">	glTranslatef(0, 14, 0); // pour le positioner sur le terrain</span><br><span class="line">	glScalef(10, 10, 10);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	glBegin(GL_TRIANGLES);</span><br><span class="line">	for (int i = 0; i &lt; chess_piece_model-&gt;nb_triangles; i++) &#123;</span><br><span class="line">		glColor3f(0.0f, 0.0f, 0.0f);</span><br><span class="line"></span><br><span class="line">		glVertex3f(chess_piece_model-&gt;points[chess_piece_model-&gt;faces[i].a].x, chess_piece_model-&gt;points[chess_piece_model-&gt;faces[i].a].y, chess_piece_model-&gt;points[chess_piece_model-&gt;faces[i].a].z);</span><br><span class="line"></span><br><span class="line">		glVertex3f(chess_piece_model-&gt;points[chess_piece_model-&gt;faces[i].b].x, chess_piece_model-&gt;points[chess_piece_model-&gt;faces[i].b].y, chess_piece_model-&gt;points[chess_piece_model-&gt;faces[i].b].z);</span><br><span class="line"></span><br><span class="line">		glVertex3f(chess_piece_model-&gt;points[chess_piece_model-&gt;faces[i].c].x, chess_piece_model-&gt;points[chess_piece_model-&gt;faces[i].c].y, chess_piece_model-&gt;points[chess_piece_model-&gt;faces[i].c].z);</span><br><span class="line">	&#125;</span><br><span class="line">	glEnd();</span><br><span class="line">	glPopMatrix();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="3-实现平台的显示"><a href="#3-实现平台的显示" class="headerlink" title="3. 实现平台的显示"></a>3. 实现平台的显示</h2><p>平台是基于立方体做transform得到的。所以要先实现立方体的绘制。</p>
<p>绘制立方体，参见这篇文章</p>
<p><a href="https://www.cnblogs.com/icmzn/p/5049768.html" target="_blank" rel="noopener">https://www.cnblogs.com/icmzn/p/5049768.html</a></p>
<p>用一个二维数组vertex_list记录立方体点位置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">static const GLfloat vertex_list[][3] = &#123;</span><br><span class="line">	-0.5f, -0.5f, -0.5f,</span><br><span class="line">	 0.5f, -0.5f, -0.5f,</span><br><span class="line">	-0.5f,  0.5f, -0.5f,</span><br><span class="line">	 0.5f,  0.5f, -0.5f,</span><br><span class="line">	-0.5f, -0.5f,  0.5f,</span><br><span class="line">	 0.5f, -0.5f,  0.5f,</span><br><span class="line">	-0.5f,  0.5f,  0.5f,</span><br><span class="line">	 0.5f,  0.5f,  0.5f,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><img src="D:\Shared Projects\WEB\blog\source\img\未分类\image-20191104151452718.png" alt="image-20191104151452718"></p>
<p>用另一个二维数组记录面和点的绘制顺序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">static const GLint index_list[][4] = &#123;</span><br><span class="line">	0, 2, 3, 1,</span><br><span class="line">	4, 6, 2, 0,</span><br><span class="line">	4, 0, 1, 5,</span><br><span class="line">	4, 6, 7, 5,</span><br><span class="line">	5, 7, 3, 1,</span><br><span class="line">	6, 2, 3, 7,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>因为为了方便在平台不同面显示不同内容（方便打广告XD），把顶面和其他面的显示分开实现。</p>
<p>用了两个texture。一个是箭头放在顶面用来实现类似劲舞团的功能，另一个是纯色图片用于装饰其他面</p>
<p>以下是显示顶面的代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">void display_cube_face() &#123;</span><br><span class="line">	glBindTexture(GL_TEXTURE_2D, texture_arrow-&gt;OpenGL_ID[0]);</span><br><span class="line"></span><br><span class="line">	glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, GL_REPEAT);</span><br><span class="line">	glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_T, GL_REPEAT);</span><br><span class="line">	glTexEnvf(GL_TEXTURE_ENV, GL_TEXTURE_ENV_MODE, GL_REPLACE);</span><br><span class="line"></span><br><span class="line">	if (texture_arrow-&gt;isRGBA)</span><br><span class="line">		gluBuild2DMipmaps(GL_TEXTURE_2D, GL_RGBA8, texture_arrow-&gt;img_color-&gt;lenx, texture_arrow-&gt;img_color-&gt;leny, GL_RGBA, GL_UNSIGNED_BYTE, texture_arrow-&gt;img_all);</span><br><span class="line">	else</span><br><span class="line">		gluBuild2DMipmaps(GL_TEXTURE_2D, GL_RGB8, texture_arrow-&gt;img_color-&gt;lenx, texture_arrow-&gt;img_color-&gt;leny, GL_RGB, GL_UNSIGNED_BYTE, texture_arrow-&gt;img_color-&gt;data);</span><br><span class="line"></span><br><span class="line">	glEnable(GL_TEXTURE_2D);</span><br><span class="line"></span><br><span class="line">	glPolygonMode(GL_FRONT, GL_FILL);</span><br><span class="line">	glPolygonMode(GL_BACK, GL_FILL);</span><br><span class="line"></span><br><span class="line">	glBegin(GL_QUADS);</span><br><span class="line">	for (int j = 0; j &lt; 4; ++j) &#123;</span><br><span class="line">		switch (j)</span><br><span class="line">		&#123;</span><br><span class="line">		case 0:</span><br><span class="line">			glTexCoord2f(0, 0);</span><br><span class="line">			break;</span><br><span class="line">		case 1:</span><br><span class="line">			glTexCoord2f(0, 1);</span><br><span class="line">			break;</span><br><span class="line">		case 2:</span><br><span class="line">			glTexCoord2f(1, 1);</span><br><span class="line">		case 3:</span><br><span class="line">			glTexCoord2f(1, 0);</span><br><span class="line">			break;</span><br><span class="line">		&#125;</span><br><span class="line">		glVertex3fv(vertex_list[index_list[5][j]]);</span><br><span class="line">	&#125;</span><br><span class="line">	glEnd();</span><br><span class="line">	glPolygonMode(GL_FRONT, GL_FILL);					// front of a face is filled</span><br><span class="line">	glPolygonMode(GL_BACK, GL_LINE);</span><br><span class="line">	glDisable(GL_ALPHA_TEST);</span><br><span class="line">	glDisable(GL_TEXTURE_2D);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="实现棋子移动"><a href="#实现棋子移动" class="headerlink" title="实现棋子移动"></a>实现棋子移动</h2><p>获取收入修改棋子位置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">if (inp-&gt;keys[KEY_CODE_W]) &#123;</span><br><span class="line">		chess_posZ += chees_move_speed;</span><br><span class="line">	&#125;</span><br><span class="line">	if (inp-&gt;keys[KEY_CODE_S]) &#123;</span><br><span class="line">		chess_posZ -= chees_move_speed;</span><br><span class="line">	&#125;</span><br><span class="line">	if (inp-&gt;keys[KEY_CODE_A]) &#123;</span><br><span class="line">		chess_posX += chees_move_speed;</span><br><span class="line">	&#125;</span><br><span class="line">	if (inp-&gt;keys[KEY_CODE_D]) &#123;</span><br><span class="line">		chess_posX -= chees_move_speed;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h2 id="实现棋子跳跃"><a href="#实现棋子跳跃" class="headerlink" title="实现棋子跳跃"></a>实现棋子跳跃</h2><p>通过两个bool变量，jump和falldown来检测棋子跳起下落状态</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">if (jump) &#123;</span><br><span class="line">		if (tim-&gt;global_timer_25_Hz)	</span><br><span class="line">		&#123;</span><br><span class="line">			if (!falldown) &#123;</span><br><span class="line">				chess_posY += 0.6f;</span><br><span class="line">			&#125;</span><br><span class="line">			else &#123;</span><br><span class="line">				chess_posY -= 0.7f;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			if (chess_posY &gt; 20) falldown = true;</span><br><span class="line">			if (chess_posY &lt; 5) &#123;</span><br><span class="line">				chess_posY = 5;</span><br><span class="line">				jump = false;</span><br><span class="line">				falldown = false;</span><br><span class="line">				//debug(&quot;end jump&quot;);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h2 id="实现类似劲舞团的输入响应"><a href="#实现类似劲舞团的输入响应" class="headerlink" title="实现类似劲舞团的输入响应"></a>实现类似劲舞团的输入响应</h2><p>用一个二维数组记录每次正确输入后，棋子的新位置，即每个棋盘所在位置。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">static const int chess_routes[][2] = &#123;</span><br><span class="line">	0,20,</span><br><span class="line">	25,20,</span><br><span class="line">	50,20,</span><br><span class="line">	50,35,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>用另一个二维数组记录，正确输入的键盘值序列。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">static const int required_inputs[] = &#123;</span><br><span class="line">	KEY_CODE_2,</span><br><span class="line">	KEY_CODE_8,</span><br><span class="line">	KEY_CODE_6,</span><br><span class="line">	KEY_CODE_4,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>每一次按方向键，检测是否输入正确，并处理</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">if (inp-&gt;keys[KEY_CODE_UP]) &#123;</span><br><span class="line">		if (required_inputs[chess_current_index] == KEY_CODE_8) &#123;</span><br><span class="line">			chess_posX = chess_routes[chess_current_index][0];</span><br><span class="line">			chess_posZ = chess_routes[chess_current_index][1];</span><br><span class="line">			chess_current_index++;</span><br><span class="line">			//debug(&quot;%d\n&quot;, chess_current_index);</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="待解决问题"><a href="#待解决问题" class="headerlink" title="待解决问题"></a>待解决问题</h2><p>主要问题是我把相机视角设置为45度俯视。跟随棋子移动有问题。如果能正确锁定棋子，可以让平台随机生成，每到一个新的平台就自动生成下个平台，并确保显示正确。现在因为视角追随问题，还不能实现。</p>
<p>第二个问题是键盘输入。如果要实现跳一跳，要知道按了多久的空格键。有待解决。</p>

        
        <br>
        <div id="comment-container">
        </div>
        <div id="disqus_thread"></div>

        <div id="lv-container">
        </div>

    </div>
</div>
    </div>
</div>


<footer class="footer">
    <ul class="list-inline text-center">
        
        

        

        
        <li>
            <a target="_blank" href="https://www.facebook.com/xiaotong.chen.luan">
                            <span class="fa-stack fa-lg">
                                <i class="iconfont icon-facebook"></i>
                            </span>
            </a>
        </li>
        

        
        <li>
            <a target="_blank" href="https://github.com/xiaotong1996">
                            <span class="fa-stack fa-lg">
                                <i class="iconfont icon-github"></i>
                            </span>
            </a>
        </li>
        

        
        <li>
            <a target="_blank" href="https://www.linkedin.com/in/xiaotong-chen-6b08ba178">
                            <span class="fa-stack fa-lg">
                                <i class="iconfont icon-linkedin"></i>
                            </span>
            </a>
        </li>
        

    </ul>
    
    <p>
        <span id="busuanzi_container_site_pv">
            <span id="busuanzi_value_site_pv"></span>PV
        </span>
        <span id="busuanzi_container_site_uv">
            <span id="busuanzi_value_site_uv"></span>UV
        </span>
        Created By <a href="https://hexo.io/">Hexo</a>  Theme <a href="https://github.com/aircloud/hexo-theme-aircloud">AirCloud</a></p>
</footer>




</body>

<script>
    // We expose some of the variables needed by the front end
    window.hexo_search_path = "search.json"
    window.hexo_root = "/"
    window.isPost = true
</script>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script src="/js/index.js"></script>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




</html>
